---
title: Openmc
date: 2024-06-14 10:27:32
mathjax: true
top: 60
categories: # 分类
- 软件学习
tags: # 标签
- 反应堆物理
- Openmc
---

# 基本概念与原理：

## 粒子权重

1. 粒子权重允许每个粒子在模拟中代表多个实际粒子。通过这种方式，可以用较少的粒子数获得足够的统计数据，从而减少计算量和模拟时间。

2. 在模拟开始时，所有粒子通常被赋予相同的权重，例如，每个粒子的权重都设置为1。

3. 在模拟过程中，根据特定的准则或算法，粒子的权重可能会被增加或减少。例如，如果某个区域的统计数据不足，可以增加该区域粒子的权重，使其在后续步骤中具有更大的影响力。
权重累积：

4. 粒子在经历散射、裂变等事件后，可能会生成新的粒子（如裂变产生的次级中子）。这些新粒子可能会继承或分配特定的权重。
权重归一化：

5. 为了确保模拟结果的准确性，所有粒子的权重在每个批次结束时通常会被归一化，以保证它们的总和等于1。这样，粒子的权重反映了它们在模拟中的相对重要性。

# Openmc 数据后处理
<!--more-->
## Tally 统计

Tally（计数器）用于在模拟过程中记录特定的物理量，例如中子通量、裂变率、吸收率等。

在蒙特卡洛模拟中，任何物理的统计形式都可以写为

$$
X = \int {d {\bf r}} \int {d {\bf \Omega}} \int {dE} f({\bf r}, {\bf \Omega}, E) \psi({\bf r}, {\bf \Omega}, E)
$$

Tally需要与Filter一起使用，来确在不同区域、方位角、表面、能量范围的计数。

通常tally.sum 给出的是一个累积值，即在模拟的所有批次中，所有批次中子通量的总和。

### Tally统计物理量

一般来讲Tally数据有三个维度:一个用Filter组合，一个用于核素Nuclide，一个用于指定的Scores。

1. **flux**  
flux统计的是单位面积（体积）上单位时间内通过的中子数。通量计数可以应用于不同的统计对象，例如：
    1. **材料（Materials）：** 如果使用材料过滤器，通量计数将统计特定材料内部的中子通量。
    2. **单元格（Cells）：** 如果使用网格过滤器（MeshFilter），通量计数将统计网格上每个单元格内的中子通量。
    3. **表面（Surfaces）：** 如果使用表面过滤器，通量计数将统计通过特定表面的中子通量。

2. **fission**  
fission统计的是在指定的几何区域（由 Tally 的过滤器定义，例如单元格、表面或材料）内发生的裂变事件总数。








# Openmc.Settings

## settings.batches

在 openmc 蒙特卡洛模拟中，每个批次的模拟通常是独立的，并且可以并行执行。以下是关于批次模拟的一些要点：

* 独立性：每个批次的模拟都是从上一个批次结束时的状态开始的。这意味着每个批次的模拟结果是基于前一个批次结束时粒子的状态和分布进行的。
* 非活跃批次：在模拟的开始阶段，可以设置一定数量的惰性批次，这些批次的统计数据不会被用于最终结果的计算。惰性批次有助于让模拟达到稳态条件，减少初始条件对结果的影响。
* 活跃批次：在惰性批次之后，模拟进入活跃阶段，此时每个批次的结果将被用于最终的统计分析。
* 批次依赖：尽管每个批次的模拟是独立的，但模拟的统计结果依赖于所有批次的累积。在模拟结束后，所有批次的结果会被合并以产生最终的统计数据。
* 状态点文件：在每个批次结束时，openmc 可以保存一个状态点文件，该文件包含了当前批次结束时的模拟状态。这些状态点文件可以用于分析、验证或作为未来模拟的起点。
* 重启模拟：如果需要，可以使用之前保存的状态点文件来重启模拟，从特定的批次继续进行模拟计算。
* 并行性：openmc 支持并行计算，可以同时运行多个批次。这种并行性是通过在多个处理器或计算节点上分配不同的批次来实现的，从而加快模拟的总体速度。